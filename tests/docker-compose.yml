services:
  pingora:
    container_name: pingora
    build:
      context: ..
      dockerfile: tests/Dockerfile.pingora
    networks:
      - app_network
    expose:
      - "8080"
      - "8081"
      - "8082"
      - "8443"
      - "8444"
      - "8445"
    # expose = make ports available to other containers (not to host)

  haproxy:
    container_name: haproxy
    build:
      context: ..
      dockerfile: tests/Dockerfile.haproxy
    networks:
      - app_network
    ports:
      - "8080:8080"
      - "8081:8081"
      - "8082:8082"
      - "8443:8443"
      - "8444:8444"
      - "8445:8445"
    
    command: [ "haproxy", "-f", "/usr/local/etc/haproxy/haproxy.cfg" ]

networks:
  app_network:
    driver: bridge
